# Railway Configuration for Investracker Backend
# This file tells Railway how to build and run the FastAPI backend
# NOTE: Railway root directory is set to "backend" in the dashboard,
# so all paths here are relative to the backend folder

[build]
builder = "NIXPACKS"
buildCommand = "pip install -r requirements.txt"

[deploy]
startCommand = "python migrate_on_startup.py && uvicorn app.main:app --host 0.0.0.0 --port $PORT"
healthcheckPath = "/health"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

# ============== Cron Jobs ==============
# Uncomment to enable scheduled stock price updates

# Active holdings price update (every 15 mins during US market hours: 9:30 AM - 4 PM EST = 14:30-21:00 UTC)
# [[crons]]
# schedule = "*/15 14-21 * * 1-5"
# command = "python -m app.tasks.fetch_stock_prices active"

# Catalog stock price update (daily at 6 AM UTC - before US market opens)
# [[crons]]
# schedule = "0 6 * * 1-5"
# command = "python -m app.tasks.fetch_stock_prices catalog"
# [[crons]]
# schedule = "0 22 * * 0"
# command = "python -m app.tasks.generate_weekly_report"
